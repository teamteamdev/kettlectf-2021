# RandomDomDom: Write-up

Нам дали ELF бинарник и сайт, на котором просят ввести код и какой-то ключ.
Видимо, их нужно как-то получить с помощью исполняемого файла, что нам дали.

Если посмотреть на строчки в файле, то видим заголовки и ответы HTTP. Можно
предположить, что данный бинарь является http сервером. Запустив под strace
видим, что он биндится на порт 3344.
```
bind(3, {sa_family=AF_INET, sin_port=htons(3344), sin_addr=inet_addr("0.0.0.0")}, 16) = 0
```
Делаем `curl localhost:3344` и в ответ нам выдают ключ. Половина дела сделана.

Вспоминаем, что в строках видели ответ 409 Conflict, посмотрим поближе в декомпиляторе.

![r2ghidra](writeup/decomp.jpg)

Видим сравнение запроса с `PATCH /`, потом мы копируем два символа пути в dest,
который пытаемся привести к строчке. Если полученный результат не совпадает с
ожидаемым возвращается 409 и сервер завершает работу. Если же все совпало, то мы
что-то отправляем и изменяем значение переменной, которая и определяла ожидаемое
значение. Поискав еще упоминание этой переменной в коде замечаем, что в самом
начале нам ее сказали как ключ, то есть, у нас есть генератор чисел с некоторым
доппреобразованием. Перепишем его на python.

```python
def gen(key):
    x = key
    while True:
        yield x % (x % 100 + 1)
        x = (x * 0xd3 + 0x503) % 0x1ec3
```

Берем ключ, который мы получили ранее, запускаем генератор и получаем большой
набор значений, который форматируем как код:
```python
g = gen(key)  # get from dom
code = '-'.join(str(next(g)) for _ in range(200))
```
Полученный код вместе с ключом отправляем на сервер и получаем флаг.

Флаг: **kettle\_d0mran\_743854894**
